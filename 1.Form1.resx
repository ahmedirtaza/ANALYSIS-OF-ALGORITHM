#include <iostream>
#include <vector>
#include <string>

//-----------------------------------------------
// Structure representing a Stock in the system
//-----------------------------------------------
struct Stock
{
    std::string symbol;   // Stock symbol (e.g., AAPL, MSFT)
    std::string name;     // Full name of the company
    double price;         // Price per share

    // Print stock information
    void print() const {
        std::cout << "Symbol: " << symbol
                  << ", Name: " << name
                  << ", Price: $" << price << std::endl;
    }
};

//-------------------------------------------------------
// Function to take input from user and create Stock list
//-------------------------------------------------------
void inputStocks(std::vector<Stock>& stocks)
{
    int n;
    std::cout << "Enter number of stocks: ";
    std::cin >> n;
    std::cin.ignore(); // Clear input buffer

    for (int i = 0; i < n; ++i)
    {
        Stock s;
        std::cout << "Enter details for stock " << i + 1 << ":\n";
        std::cout << "  Symbol: ";
        std::getline(std::cin, s.symbol);

        std::cout << "  Name: ";
        std::getline(std::cin, s.name);

        std::cout << "  Price: ";
        std::cin >> s.price;
        std::cin.ignore();

        stocks.push_back(s);
    }
}

//------------------------------------
// Merge function for Merge Sort
//------------------------------------
void merge(std::vector<Stock>& stocks, int left, int mid, int right, int sortBy)
{
    int n1 = mid - left + 1;
    int n2 = right - mid;

    // Temporary arrays
    std::vector<Stock> L(n1), R(n2);

    // Copy data to temp arrays
    for (int i = 0; i < n1; ++i)
        L[i] = stocks[left + i];
    for (int i = 0; i < n2; ++i)
        R[i] = stocks[mid + 1 + i];

    // Merge the temp arrays back into stocks
    int i = 0, j = 0, k = left;

    while (i < n1 && j < n2)
    {
        bool takeLeft = false;
        // Sort by price
        if (sortBy == 1)
            takeLeft = L[i].price <= R[j].price;
        // Sort by symbol
        else if (sortBy == 2)
            takeLeft = L[i].symbol <= R[j].symbol;
        // Sort by name
        else
            takeLeft = L[i].name <= R[j].name;

        if (takeLeft)
        {
            stocks[k] = L[i];
            ++i;
        }
        else
        {
            stocks[k] = R[j];
            ++j;
        }
        ++k;
    }

    // Copy the remaining elements
    while (i < n1)
        stocks[k++] = L[i++];
    while (j < n2)
        stocks[k++] = R[j++];
}

//-------------------------------------
// Recursive Merge Sort implementation
//-------------------------------------
void mergeSort(std::vector<Stock>& stocks, int left, int right, int sortBy)
{
    if (left < right)
    {
        int mid = left + (right - left) / 2;
        // Recursively sort first and second halves
        mergeSort(stocks, left, mid, sortBy);
        mergeSort(stocks, mid + 1, right, sortBy);
        // Merge the sorted halves
        merge(stocks, left, mid, right, sortBy);
    }
}

//--------------------------------------
// Display all stocks in the list
//--------------------------------------
void displayStocks(const std::vector<Stock>& stocks)
{
    std::cout << "\nStocks in the system:\n";
    for (const auto&s : stocks) {
        s.print();
    }
}

//------------------------
// Main program function
//------------------------
int main()
{
    std::vector<Stock> stocks; // Vector to store all stocks
    int choice = 0;

    // Main system loop
    while (choice != 4)
    {
        // Display system menu
        std::cout << "\n--- Stock Market System Menu ---\n";
        std::cout << "1. Add Stocks\n";
        std::cout << "2. Display Stocks\n";
        std::cout << "3. Sort Stocks\n";
        std::cout << "4. Exit\n";
        std::cout << "Enter your choice: ";
        std::cin >> choice;
        std::cin.ignore();

        switch (choice)
        {
            case 1:
                inputStocks(stocks); // Add stocks
                break;
            case 2:
                displayStocks(stocks); // Show all stocks
                break;
            case 3:
                if (stocks.empty())
                {
                    std::cout << "No stocks to sort!\n";
                    break;
                }
                std::cout << "Sort by:\n";
                std::cout << "  1. Price\n";
                std::cout << "  2. Symbol\n";
                std::cout << "  3. Name\n";
                std::cout << "Enter sort criteria: ";
                int sortBy;
                std::cin >> sortBy;
                std::cin.ignore();
                // Call mergeSort
                mergeSort(stocks, 0, stocks.size() - 1, sortBy);
                std::cout << "Stocks sorted successfully.\n";
                break;
            case 4:
                std::cout << "Exiting system...\n";
                break;
            default:
                std::cout << "Invalid choice. Please try again.\n";
                break;
        }
    }

    return 0;
}
